<div class="sidebar-wrapper">
    <div class="logoimg">
        <a id="logosete" href="#">
            <img src="img/icones/logosete.png" />
        </a>
    </div>
    <div class="user">
        <div class="photo">
            <img src="img/icones/settings.svg">
        </div>
        <div class="info ">
            <a data-toggle="collapse" href="#collapseExample" class="collapsed">
                <span><span id="userName">Carregando ...</span>
                    <b class="caret"></b>
                </span>
            </a>
            <div class="collapse" id="collapseExample">
                <ul class="nav">
                    <li>
                        <a name="config/configuracoes-view" class="mt-2 link-menu profile-dropdown" href="#">
                            <i class="ml-1 fa fa-address-book menu-icon" aria-hidden="true"></i>
                            <span class="sidebar-normal">Meu Perfil</span>
                        </a>
                    </li>
                    <li>
                        <a name="usuario/usuario-listar-view" class="link-menu profile-dropdown" href="#">
                            <i class="ml-1 fa fa-users menu-icon" aria-hidden="true"></i>
                            <span class="sidebar-normal">Outros Usuários</span>
                        </a>
                    </li>
                    <li>
                        <a id="syncBtn" name="config/sync" class="profile-dropdown" href="#">
                            <i class="ml-1 fa fa-refresh menu-icon" aria-hidden="true"></i>
                            <span class="sidebar-normal">Sincronizar</span>
                        </a>
                    </li>
                    <li>
                        <a id="sairBtn" name="config/config-sair" class="profile-dropdown" href="#">
                            <i class="ml-1 fa fa-sign-out menu-icon" aria-hidden="true"></i>
                            <span class="sidebar-normal">Sair</span>
                        </a>
                    </li>
                    <li>
                        <a name="config/config-versao-view" class="link-menu profile-dropdown" href="#">
                            <i class="ml-1 fa fa-info-circle menu-icon" aria-hidden="true"></i>
                            <span class="sidebar-normal">Versão</span>
                        </a>
                    </li>
                </ul>
                </li>
            </div>
        </div>
    </div>
    <ul class="nav">
        <!-- <li class="nav-item ">
            <a class="nav-link" href="./dashboard.html">
                <i class="nc-icon nc-chart-pie-35"></i>
                <p>Visão Geral</p>
            </a>
        </li> -->
        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#censoMenu">
                <img src="./img/icones/censo_white.png" class="menu-icon">
                <p>
                    Censo Escolar
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="censoMenu">
                <ul class="nav">

                    <li class="nav-item ">
                        <a name="censo/censo-importar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Importar Base de Dados</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#alunoMenu">
                <img src="./img/icones/aluno.svg" class="menu-icon">
                <p>
                    Alunos
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="alunoMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="aluno/aluno-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="aluno/aluno-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="aluno/aluno-importar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Importar de Planilha Eletrônica</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="aluno/aluno-visualizar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Visualizar</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#escolaMenu">
                <img src="./img/icones/escolas.svg" class="menu-icon">
                <p>
                    Escolas
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="escolaMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="escola/escola-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="escola/escola-importar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Importar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="escola/escola-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="escola/escola-visualizar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Visualizar</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#motoristaMenu">
                <img src="./img/icones/motoristas.svg" class="menu-icon">
                <p>
                    Motoristas
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="motoristaMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="motorista/motorista-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="motorista/motorista-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#veiculoMenu">
                <img src="./img/icones/frotas.svg" class="menu-icon">
                <p>
                    Frota
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="veiculoMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="frota/frota-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="frota/garagem-visualizar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Garagem</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="frota/frota-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="frota/frota-os-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Ordens de Serviço</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#fornecedorMenu">
                <img src="./img/icones/fornecedores.svg" class="menu-icon">
                <p>
                    Fornecedores
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="fornecedorMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="fornecedor/fornecedor-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="fornecedor/fornecedor-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#rotaMenu">
                <img src="./img/icones/rotas.svg" class="menu-icon">
                <p>
                    Rotas
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="rotaMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="rota/rota-cadastrar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Cadastrar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="rota/rota-desenhar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-mini"></span>
                            <span class="sidebar-normal">Desenhar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="rota/rota-listar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Gerenciar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="rota/rota-importar-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Importar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="rota/rota-malha-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-mini"></span>
                            <span class="sidebar-normal">Malha Viária</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="rota/rota-sugestao-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-mini"></span>
                            <span class="sidebar-normal">Sugerir</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#relatoriosMenu">
                <img src="./img/icones/relatorios.svg" class="menu-icon">
                <p>
                    Relatórios
                    <b class="caret"></b>
                </p>
            </a>
            <div class="collapse " id="relatoriosMenu">
                <ul class="nav">
                    <li class="nav-item ">
                        <a name="relatorio/relatorio-aluno-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Alunos</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="relatorio/relatorio-escola-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Escolas</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="relatorio/relatorio-frota-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Frota</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a name="relatorio/relatorio-rota-view" class="link-menu nav-link" href="#">
                            <span class="sidebar-normal">Rotas</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>
    </ul>
</div>

<script>
    // Variável que indica se as funções foram ou não desabilitadas
    var linksHabilitado = true;

    // Funções para desabilitar/habilitar links quando usuário estiver offline
    var desabilitaLinksMenu = (msg = 'Esta função só está habilitada se você estiver conectado à Internet.') => {
        $("li.nav-item").has("a[name*='cadastrar'], a[name*='importar']").addClass("disabled");
        $("a[name*='cadastrar'], a[name*='importar']").unbind("click");
        $("a[name*='cadastrar'], a[name*='importar']").bind("click", () => {
            Swal2.fire({
                icon: 'error',
                title: 'Oops...',
                text: msg,
            })
        });

        linksHabilitado = false;
    }

    var habilitaLinksMenu = () => {
        $("li.nav-item").has("a[name*='cadastrar'], a[name*='importar']").removeClass("disabled");
        $("li.nav-item a[name*='cadastrar'], li.nav-item a[name*='importar']").unbind("click");
        $(".link-menu").unbind("click");
        $(".link-menu").on('click', function () {
            $(".activeLink").removeClass("activeLink");
            $(this.parentElement).addClass("activeLink");
            navigateDashboard("./modules/" + $(this).attr("name") + ".html");
        });
    }

    // Função para verifica se o usuário está online
    function isOnline() {
        return navigator.onLine;
    }

    var funcMonitorRede = window.setInterval(function () {
        if (!isOnline() || userRole == "EDITOR") {
            if (linksHabilitado) {
                desabilitaLinksMenu();
            }
            $("td a[class*='Student'], td a[class*='Edit'], td a[class*='Remove']").remove();
        } else {
            habilitaLinksMenu();
        }
    }, 5000);

    $('.collapse').on('show.bs.collapse', function () {
        $('.collapse.show').each(function(){
            if ($(this).find(".activeLink").length == 0) {
                $(this).collapse('hide');
            } else {
                $(this).collapse('show');
            }
        });
    });

    $(document).ready(function () {
        // Logo
        $("#logosete").click(() => {
            $(".activeLink").removeClass("activeLink");
            action = "dashboard";
            $("#content").load("./dashboard-main.html");
        });

        // Sync
        $("#syncBtn").on('click', () => {
            $(".activeLink").removeClass("activeLink");
            $("#syncBtn").parent().addClass("activeLink");
            fbSync();
        });

        // Menu
        $("#sairBtn").click(() => {
            Swal2.fire({
                title: "Saindo do sistema...",
                text: "Espere um minutinho...",
                imageUrl: "img/icones/sair.png",
                icon: "img/icones/sair.png",
                buttons: false,
                showSpinner: true,
                closeOnClickOutside: false,
                allowOutsideClick: false,
                showConfirmButton: false
            });
            setTimeout(() => {
                document.location.href = "./login-view.html";
            }, 1000)
        });

        // Habilita ou desabilita menus com base no perfil do usuário
        return remotedb.collection("config")
            .doc(codCidade)
            .get({ source: "server" })
            .then((res) => {
                let config = res.data();
                config.readers.forEach(idReader => {
                    if (idReader == userconfig.get("ID")) {
                        userRole = "EDITOR";
                    }
                })
                habilitaLinksMenu();
                if (userRole == "EDITOR") {
                    desabilitaLinksMenu("Você não possui permissão para cadastrar ou alterar os dados deste município");
                }
            })
    });
</script>